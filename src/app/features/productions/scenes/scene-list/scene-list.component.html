<div>
  <!-- Loading spinner -->
  <div *ngIf="loading" class="text-center my-3">
    <mat-spinner diameter="40" class="mx-auto"></mat-spinner>
    <p class="mt-2">Loading scenes...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Add Scene Button -->
  <!-- <div class="mb-3">
    <button mat-raised-button color="primary" (click)="openNewSceneModal()">
      <mat-icon>add</mat-icon> Add New Scene
    </button>
  </div> -->

  <ul class="breakdown-rows scene-row" *ngFor="let scene of scenes">
    <li style="width: 2%;">
      <input
        type="checkbox"
        class="shot-checkbox individual-scene-checkbox"
        [id]="'check-scene-' + scene.id"
        [name]="'check-scene-' + scene.id"
        [value]="scene.id"
        [attr.data-scene-id]="scene.id"
        [attr.data-sequence-id]="scene.sequenceId">
    </li>
    <a style="width: 8%;" class="table-collapse-btn" data-bs-toggle="collapse" [href]="'#collapse-scene-' + scene.id"
      role="button" aria-expanded="false" [attr.aria-controls]="'collapse-scene-' + scene.id">
      <li>{{ sequencePrefix }}:{{ scene.number }}</li>
    </a>
    <li style="width: 5%;">
      <button
        type="button"
        class="btn-transparent"
        title="Scene"
        data-bs-toggle="tooltip">
        <i class="bi bi-film"></i>
      </button>
    </li>
    <li style="width: 5%;">
      {{ scene.int_ext === 'interior' ? 'Int - ' : 'Ext - ' }}
    </li>
    <li
      style="width: 20%;"
      class="inline-cell scene-location"
      [attr.data-scene-id]="scene.id"
      [id]="'scene-location-' + scene.id">
        {{ scene.location }}
    </li>
    <li style="width: 15%;">
      <i class="bi bi-brightness-alt-high-fill"></i> {{ scene.day_night }}
    </li>
    <li style="width: 5%;">
      <div class="scene-length">
        {{ scene.length }}
      </div>
      <div class="scene-length-corner"></div>
      <div class="scene-length-fold"></div>
    </li>
    <li style="width: 5%;">
    </li>
    <li style="width: 30%;"></li>
    <li style="width: 5%;">
      <div class="dropdown">
        <button class="btn btn-small" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          <mat-icon>more_horiz</mat-icon>
        </button>
        <ul class="dropdown-menu">
          <li>
            <button class="dropdown-item" data-bs-toggle="modal"
              [attr.data-bs-target]="'#scene-' + scene.id + '-actionB-modal'">
              Add Action Beat
            </button>
          </li>
          <li>
            <button mat-button color="accent" (click)="openEditModal(scene)">Edit</button>
          </li>
          <li>
            <button mat-icon-button color="warn" (click)="deleteScene(scene.id!)">
              <mat-icon>delete</mat-icon>
            </button>
          </li>
        </ul>
      </div>
    </li>
  </ul>

  <p *ngIf="scenes.length === 0 && !loading" class="text-center">No scenes available for this sequence.</p>

  <!-- Edit Scene Modal -->
  <app-modal [title]="'Edit Scene'" [isOpen]="showEditModal" (close)="showEditModal = false">
    <form (ngSubmit)="updateScene()">
      <div class="mb-3">
        <label for="editNumber" class="form-label">Number</label>
        <input
          type="number"
          class="form-control"
          id="editNumber"
          [(ngModel)]="selectedElement.number"
          name="number"
          required
        >
      </div>
      <div class="mb-3">
        <label for="editIntExt" class="form-label">INT/EXT</label>
        <select
          class="form-select"
          id="editIntExt"
          [(ngModel)]="selectedElement.int_ext"
          name="intExt"
          required>
          <option value="" disabled selected>Select INT/EXT</option>
          <option value="interior">INT</option>
          <option value="exterior">EXT</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="editLocation" class="form-label">Location</label>
        <input
          type="text"
          class="form-control"
          id="editLocation"
          [(ngModel)]="selectedElement.location"
          name="location"
          required
        >
      </div>
      <div class="mb-3">
        <label for="editTimeOfDay" class="form-label">Time of Day</label>
        <input
          type="text"
          class="form-control"
          id="editTimeOfDay"
          [(ngModel)]="selectedElement.day_night"
          name="timeOfDay"
        >
      </div>
      <div class="mb-3">
        <label for="editLength" class="form-label">Scene Length</label>
        <input
          type="text"
          class="form-control"
          id="editLength"
          name="length"
          [(ngModel)]="selectedElement.length"
          placeholder="1/8"
        >
      </div>
      <div class="modal-actions">
        <button type="button" mat-button (click)="showEditModal = false">Cancel</button>
        <button type="submit" mat-raised-button color="primary">Save</button>
      </div>
    </form>
  </app-modal>

  <!-- New Scene Modal -->
  <app-modal [title]="'Add New Scene'" [isOpen]="showNewSceneModal" (close)="closeNewSceneModal()">
    <app-scene-new
      [sequenceId]="sequenceId"
      [productionId]="productionId"
      (sceneCreated)="onSceneCreated()">
    </app-scene-new>
  </app-modal>
</div>
